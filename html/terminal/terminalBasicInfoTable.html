
<table id="terminalInfoTable"  cellspacing="0" toolbar="#terminalInfoTable_tab" cellpadding="0" border="false" style="height:100%;width: 100%;">
                <thead>
                <tr style="font-size: 15px;">
                    <th field="tmName" width="11%" align="center" style="font-size: 20px;">终端名称</th>
                    <th field="tmNum" width="11%" align="center">终端编号</th>
                    <th field="tmCompany" width="11%" align="center">所属门店</th>
                    <th field="tmStore" width="11%" align="center">所属分公司</th>
                    <th field="tmState" width="11%" align="center">状态</th>
                    <th field="tmMemusedRate" width="11%" align="center">内存使用率</th>
                    <th field="tmCPUuserRate" width="11%" align="center">CPU使用率</th>
                    <th field="tmDiskuserRate" width="11%" align="center">硬盘使用率</th>
                    <th field="tmDiskNum" width="11%" align="center">硬盘序列号</th>

                </tr>
                </thead>

            </table>
<div id="terminalInfoTable_tab" style="padding-left:10px;padding-top:10px;height: 40%;font-size: 15px;">
                <div style="height: 50%;">
                    <table style="padding-left: 10px;height: 10%;width: 95%">
                        <tr>
                            <td>
                                <input id="infoPartionCompany_select" class="easyui-combobox" data-options="prompt:'选择分公司'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;">
                                <input id="infoStore_select" class="easyui-combobox" data-options="prompt:'选择门店'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;">
                                <input id="infoTerminalType_select" class="easyui-combobox" data-options="prompt:'选择终端类型'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>

                            <td style="padding-left: 50px;">
                                <input id="infoType_select" class="easyui-combobox" data-options="prompt:'选择状态'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                        </tr>
                        <tr >
                            <td style="padding-top: 10px;">
                                <input id="infoTerminalName_input" class="easyui-textbox" data-options="prompt:'输入终端名称'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>

                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="infoTerminalNo_input" class="easyui-textbox" data-options="prompt:'输入终端编号'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="infoLagerMemoryUseRate" class="easyui-textbox" data-options="prompt:'>=内存使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="infoSmallerMemoryUseRate" class="easyui-textbox" data-options="prompt:'<=内存使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding-top: 10px;">
                                <input id="infoLagerCPUUseRate" class="easyui-textbox" data-options="prompt:'>=CPU使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="infoSmallerCPUUseRate" class="easyui-textbox" data-options="prompt:'<=CPU使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="infoLagerDiskUseRate" class="easyui-textbox" data-options="prompt:'>=硬盘使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="infoSmallerDiskUseRate" class="easyui-textbox" data-options="prompt:'<=硬盘使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                        </tr>
                    </table>

                </div>

                <div style="padding-top: 40px;padding-left: 10px;width: 100%">
                        <span style="width: 20%;">
                            <a style="background: #99BBE8;height: 30px;;width: 80px;color: black;" class="easyui-linkbutton" plain="true" onclick="searchTerminal()">搜索</a>
                        </span>
                        <span style="padding-left: 10px;width: 20%;">
                           <a style="background: #99BBE8;height: 30px;width: 80px;color: black;" class="easyui-linkbutton" plain="true" onclick="info_reset()">重置</a>
                        </span>

                    <span style="padding-left: 10px;width: 20%;">
                           <a style="background: #99BBE8;height: 30px;width: 80px;color: black;" href="#" class="easyui-linkbutton" plain="true" onclick="exportTable()">导出excel</a>
                        </span>

                </div>
            </div>


<script>


    $('#terminalInfoTable').datagrid({
        height:"90%",
        closable:true,
        fitColumns:true,
        nowrap: false,
        striped: true,
        border: true,
        collapsible:false,//是否可折叠的
        fit: true,//自动大小
        remoteSort:false,
        idField:'fldId',
        singleSelect:false,//是否单选
        pagination:true,//分页控件
        rownumbers:false,//行号,
        selectOnCheck: true,
        checkOnSelect: true
    });

    var p = $('#terminalInfoTable').datagrid('getPager');
    $(p).pagination({
        pageSize: 10,
        pageList: [5,10,15],
        beforePageText: '',
        afterPageText: '',
        displayMsg: '共 {total} 条记录'
    });

    $("#infoPartionCompany_select").combobox({
        onChange: function (n,o) {
            getinfo_Stores();
        }
    });

    $(function () {
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/company",
            type: 'GET',
            contentType:"application/json",
            data: {
                partnerId:0
            },
            success: function (res) {
                if(res.statusCode === 100) {
                    //res = JSON.stringify(res);

                    let data = res.company;
                    console.log(data);
                    let companies = [];
                    for (let i in data) {
                        companies.push({"text": data[i].CompanyName, "value": data[i].CompanyCode});
                    }
                    console.log(JSON.stringify(companies));
                    $("#infoPartionCompany_select").combobox('loadData', companies);
                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });


    });

    function getinfo_Stores(){
        let companyId = $('#infoPartionCompany_select').combobox('getValue');
        console.log(companyId);
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/store",
            type: 'GET',
            contentType:"application/json",
            data: {
                companyCode:companyId
            },
            success: function (res) {
                console.log(res);
                if(res.statusCode === 100){
                    // res = JSON.stringify(res);
                    let data = res.stores;
                    let stores = [];
                    for(let i in data){
                        if(data[i].CompanyCode === companyId){
                            stores.push({ "text": data[i].StoreName, "value": data[i].StoreID });
                        }
                    }
                    $("#infoStore_select").combobox('loadData', stores);
                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }

    function info_reset(){
        $('#infoPartionCompany_select').combobox('setValue',"");
        $('#infoStore_select').combobox('setValue',"");
        $('#infoTerminalType_select').combobox('setValue',"");
        $('#infoType_select').combobox('setValue',"");
        $('#infoTerminalName_input').textbox('setValue',"");
        $('#infoTerminalNo_input').textbox('setValue',"");
        $('#infoLagerMemoryUseRate').textbox('setValue',"");
        $('#infoSmallerMemoryUseRate').textbox('setValue',"");
        $('#infoLagerCPUUseRate').textbox('setValue',"");
        $('#infoSmallerCPUUseRate').textbox('setValue',"");
        $('#infoLagerDiskUseRate').textbox('setValue',"");
        $('#infoSmallerDiskUseRate').textbox('setValue',"");
    }

    function searchTerminal(){

        let grid = $('#terminalInfoTable');
        let options = grid.datagrid('getPager').data("pagination").options;

        let pageIndex = parseInt(options.pageNumber)-1;
        let pageSize = parseInt(options.pageSize);

        let componayCode = $('#infoPartionCompany_select').combobox('getValue');
        let storeId = $('#infoStore_select').combobox('getValue');
        let posType = $('#infoTerminalType_select').combobox('getValue');
        let state = $('#infoType_select').combobox('getValue');
        let postName = $('#infoTerminalName_input').textbox('getValue');
        let posId = $('#infoTerminalNo_input').textbox('getValue');
        let memoryUsedBegin = $('#infoLagerMemoryUseRate').textbox('getValue');
        let memoryUsedEnd = $('#infoSmallerMemoryUseRate').textbox('getValue');
        let cpuUsedBegin = $('#infoLagerCPUUseRate').textbox('getValue');
        let cpuUsedEnd = $('#infoSmallerCPUUseRate').textbox('getValue');
        let diskUsedBegin = $('#infoLagerDiskUseRate').textbox('getValue');
        let diskUsedEnd = $('#infoSmallerDiskUseRate').textbox('getValue');

        let reqDate = {
            pageIndex:pageIndex,
            pageSize:pageSize,
            companyCode:componayCode,
            storeId:storeId,
            posType:posType,
            state:state,
            postName:postName,
            posId:posId,
            memoryUsedBegin:memoryUsedBegin,
            memoryUsedEnd:memoryUsedEnd,
            cpuUsedBegin:cpuUsedBegin,
            cpuUsedEnd:cpuUsedEnd,
            diskUsedBegin:diskUsedBegin,
            diskUsedEnd:diskUsedEnd
        }




        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/pos",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify(reqDate),
            success: function (res) {
                console.log(res);
                if(res.statusCode === 100){
                    let listData = res.data.rows;
                    let listDatas = new Array();
                    for ( let i=0;i<parseInt(res.data.total);i++) {
                        let rowData =  {
                            //'tmName' : listData[i].ID,
                            'tmNum' : listData[i].PosID,
                            //'tmCompany' : listData[i].StartTime,
                            'tmStore' : listData[i].StoreName,
                            'tmState':listData[i].Status,
                            'tmMemusedRate' : listData[i].MemoryUsed,
                            'tmCPUuserRate' : listData[i].CPULoad,
                            'tmDiskuserRate' : listData[i].DiskUsed,//??
                            //'tmDiskNum' : listData[i].Status
                        };
                        listDatas.push(rowData);
                    }

                    $('#terminalInfoTable').datagrid('loadData',listDatas);

                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }




</script>