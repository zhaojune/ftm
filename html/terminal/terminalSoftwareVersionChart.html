<div>
    <table style="width: 100%;padding-top: 10px;">
        <tr>
            <td style="padding-left: 20px;">
                <input id="versionPartionCompany_select" class="easyui-combobox" data-options="prompt:'选择分公司'" style="font-size: 15px;color:gainsboro;width:200px;height: 30px;"/>
            </td>
            <td >
                <input id="versionStore_select" class="easyui-combobox" data-options="prompt:'选择门店'" style="font-size: 15px;color:gainsboro;width:200px;height: 30px;"/>
            </td>
            <td>
                <input id="versionTerminalType_select" class="easyui-combobox" data-options="prompt:'选择终端类型'" style="font-size: 15px;color:gainsboro;width:100px;height: 30px;"/>
            </td>
            <td>
                <a style="background: #99BBE8;height: 30px;;width: 80px;color: black;" href="#" class="easyui-linkbutton" plain="true" onclick="doSearch()">搜索</a>
            </td>
        </tr>
    </table>
</div>

<div style="width: 100%">
    <div style="border-bottom: 1px solid #99BBE8;width:45%;height: 2%;padding: 20px;float:left;">
        <span style="font-size: 15px;">NP6版本统计</span>
        <div id="chart_np6" style="width: 320px;height:200px;"></div>
    </div>
    <div style="border-bottom: 1px solid #99BBE8;width:45%;height: 2%;padding: 20px;float:right;">
        <span style="font-size: 15px;">NP6 APP版本统计</span>
        <div id="chart_np6app" style="width: 320px;height:200px;"></div>
    </div>
</div>
<div style="width: 100%">
    <div style="border-bottom: 1px solid #99BBE8;width:45%;height: 2%;padding: 20px;float:left;">
        <span style="font-size: 15px;">SOK图片版本统计</span>
        <div id="chart_sok" style="width: 320px;height:200px;"></div>
    </div>
    <div style="border-bottom: 1px solid #99BBE8;width:45%;height: 2%;padding: 20px;float:right;">
        <span style="font-size: 15px;">自有版本统计</span>
        <div id="chart_self" style="width: 320px;height:200px;"></div>
    </div>
</div>
<div style="width: 100%">
    <div style="border-bottom: 1px solid #99BBE8;width:45%;height: 2%;padding: 20px;float:left;">
        <span style="font-size: 15px;">键位版本统计</span>
        <div id="chart_fork" style="width: 320px;height:200px;"></div>
    </div>
</div>

<script type="text/javascript">
    jQuery.support.cors = true;
    var chart_np6 = echarts.init(document.getElementById('chart_np6'));
    var chart_np6app = echarts.init(document.getElementById('chart_np6app'));
    var chart_sok = echarts.init(document.getElementById('chart_sok'));
    var chart_self = echarts.init(document.getElementById('chart_self'));
    var chart_fork = echarts.init(document.getElementById('chart_fork'));
    var companyCode = '100', storeId = '1', type = 'sc';
    $(function () {
        getCompany();
        getPosType();
        getData();
    })

    function doSearch() {
        companyCode = $("#versionPartionCompany_select").combobox("getValue");
        storeId = $("#versionStore_select").combobox("getValue");
        type = $("#versionTerminalType_select").combobox("getValue");
        getData();
    }

    function getData(){
        getNp6Data();
        getNp6AppData();
        getSokData();
        getSelfSoftData();
        getForkData();
    }

    function getNp6Data() {
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/posbassis2",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "storeId":storeId,
                "companyCode":companyCode,
                "type":type,
                "bassis":"Np6Version"}),
            success: function (data) {
                if(data.status_code == 100){
                    np6Chart(data.data);
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        })
    }

    function getNp6AppData() {
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/posbassis2",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "storeId":storeId,
                "companyCode":companyCode,
                "type":type,
                "bassis":"Np6ExeVersion"}),
            success: function (data) {
                if(data.status_code == 100){
                    np6AppChart(data.data);
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        })
    }

    function getSokData() {
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/posbassis2",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "storeId":storeId,
                "companyCode":companyCode,
                "type":type,
                "bassis":"SOKPicVer"}),
            success: function (data) {
                if(data.status_code == 100){
                    sokChart(data.data);
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        })
    }

    function getSelfSoftData() {
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/posbassis2",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "storeId":storeId,
                "companyCode":companyCode,
                "type":type,
                "bassis":"SelfSoft"}),
            success: function (data) {
                console.log(data)
                if(data.status_code == 100){
                    selfChart(data.data);
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        })
    }

    function getForkData() {
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/posbassis2",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "storeId":storeId,
                "companyCode":companyCode,
                "type":type,
                "bassis":"ForkVersion"}),
            success: function (data) {
                if(data.status_code == 100){
                    forkChart(data.data);
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        })
    }

    function np6Chart(data) {
        var option = {
            title : {
                text: 'POS终端NP6版本统计',
                subtext: '非码科技',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series : [
                {
                    name: '',
                    type: 'pie',
                    radius : '55%',
                    center: ['50%', '60%'],
                    data:data,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        chart_np6.setOption(option);
    }
    function np6AppChart(data) {
        var option = {
            title : {
                text: 'POS终端NP6 APP版本统计',
                subtext: '非码科技',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series : [
                {
                    name: '',
                    type: 'pie',
                    radius : '55%',
                    center: ['50%', '60%'],
                    data:data,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        chart_np6app.setOption(option);
    }
    function sokChart(data) {
        var option = {
            title : {
                text: 'POS终端SOK版本统计',
                subtext: '非码科技',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series : [
                {
                    name: '',
                    type: 'pie',
                    radius : '55%',
                    center: ['50%', '60%'],
                    data:data,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        chart_sok.setOption(option);
    }
    function selfChart(data) {
        var option = {
            title : {
                text: 'POS终端自有版本统计',
                subtext: '非码科技',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series : [
                {
                    name: '',
                    type: 'pie',
                    radius : '55%',
                    center: ['50%', '60%'],
                    data:data,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        chart_self.setOption(option);
    }
    function forkChart(data) {
        var option = {
            title : {
                text: 'POS终端键位版本统计',
                subtext: '非码科技',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series : [
                {
                    name: '',
                    type: 'pie',
                    radius : '55%',
                    center: ['50%', '60%'],
                    data:data,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        chart_fork.setOption(option);
    }

    function getCompany() {
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/company",
            type: 'GET',
            contentType:"application/json",
            data: {
                partnerId:1205
            },
            success: function (data) {
                if(data.status_code == 100){
                    $("#versionPartionCompany_select").combobox({
                        data: data.company,
                        valueField: 'CompanyCode',
                        textField: 'CompanyName',
                        onLoadSuccess: function () {
//                            var val = $(this).combobox("getData");
//                            for (var item in val[0]) {
//                                if (item == "CompanyCode") {
//                                    $(this).combobox("select", val[0][item]);
//                                }
//                            }
                        },
                        onSelect:function(record){
                            //$.messager.alert('提示', $('#infoPartionCompany_select').combobox('getValue'));
                            getStore($('#versionPartionCompany_select').combobox('getValue'))
                        }
                    });
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }

    function getStore(companyCode) {
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/store",
            type: 'GET',
            contentType:"application/json",
            data: {
                companyCode:companyCode
            },
            success: function (data) {
                if(data.status_code == 100){
                    $("#versionStore_select").combobox({
                        data: data.stores,
                        valueField: 'StoreID',
                        textField: 'StoreName',
                        onLoadSuccess: function () {
//                            var val = $(this).combobox("getData");
//                            for (var item in val[0]) {
//                                if (item == "StoreID") {
//                                    $(this).combobox("select", val[0][item]);
//                                }
//                            }
                        },
                        onSelect:function(record){
                            //$.messager.alert('提示', $('#infoStore_select').combobox('getValue'));
                        }
                    });
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }

    function getPosType() {
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/posattr",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({"attrs":["Type"]}),
            success: function (data) {
                if(data.status_code == 100){
                    $("#versionTerminalType_select").combobox({
                        data: data.dic.Type,
                        valueField: 'Attr',
                        textField: 'Attr',
                        onLoadSuccess: function () {
//                            var val = $(this).combobox("getData");
//                            for (var item in val[0]) {
//                                if (item == "Attr") {
//                                    $(this).combobox("select", val[0][item]);
//                                }
//                            }
                        },
                        onSelect:function(record){
                            //$.messager.alert('提示', $('#infoTerminalType_select').combobox('getValue'));
                        }
                    });
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }
</script>

