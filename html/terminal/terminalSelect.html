
    <div  style="width:100%;height:99.5%;border:1px;border-style: solid;border-color:#aac5e7;" >
        <div class="easyui-tabs" id="tabs" style="width:100%;height:545px;">
            <div align="center" title="选择终端" style="padding-top: 10px;font-size: 15px;color: #95B8E7;font-family: 'Arial Black';">

                <table id="selectTerminalTable"  cellspacing="0" toolbar="#selectTerminal_tab" cellpadding="0" border="false" style="height:100%;width: 100%;">
                    <thead>
                    <tr style="font-size: 15px;">
                        <th field= 'ck'  checkbox="true"></th>
                        <th field="num" width="11%" align="center" style="font-size: 20px;">序号</th>
                        <th field="tmsNo" width="11%" align="center">终端编号</th>
                        <th field="tmsStore" width="11%" align="center">所属门店</th>
                        <th field="tmsCompany" width="11%" align="center">所属分公司</th>
                        <th field="tmsState" width="11%" align="center">状态</th>
                        <th field="tmsMemUsed" width="11%" align="center">内存使用率</th>
                        <th field="tmsCPNUsed" width="11%" align="center">CPU使用率</th>
                        <th field="tmsDiskUsed" width="11%" align="center">硬盘使用率</th>
                        <th field="tmsNum" width="11%" align="center">硬盘序列号</th>

                    </tr>
                    </thead>

                </table>


                <div id="selectTerminal_tab" style="padding-left:10px;padding-top:10px;height: 40%;font-size: 15px;">
                    <div style="height: 50%;">
                        <table style="padding-left: 10px;height: 10%;width: 95%">
                            <tr>
                                <td>
                                    <input id="tsPartionCompany_select" editable="false" class="easyui-combobox" data-options="prompt:'选择分公司'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>
                                <td style="padding-left: 50px;">
                                    <input id="tsStore_select" editable="false" class="easyui-combobox" data-options="prompt:'选择门店'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>
                                <td style="padding-left: 50px;">
                                    <input id="tsTerminalType_select" class="easyui-combobox" editable="false" data-options="prompt:'选择终端类型'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>

                                <td style="padding-left: 50px;">
                                    <input id="tsType_select" class="easyui-combobox" data-options="prompt:'选择状态'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>
                            </tr>
                            <tr >
                                <td style="padding-top: 10px;">
                                    <input id="tsTerminalName_input" class="easyui-textbox" data-options="prompt:'输入终端名称'" editable="false" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>

                                </td>
                                <td style="padding-left: 50px;padding-top: 10px;">
                                    <input id="tsTerminalNo_input" class="easyui-numberbox" data-options="prompt:'输入终端编号'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>
                                <td style="padding-left: 50px;padding-top: 10px;">
                                    <input id="tsLagerMemoryUseRate" class="easyui-textbox" data-options="prompt:'>=内存使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>
                                <td style="padding-left: 50px;padding-top: 10px;">
                                    <input id="tsSmallerMemoryUseRate" class="easyui-textbox" data-options="prompt:'<=内存使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>
                            </tr>
                            <tr>
                                <td style="padding-top: 10px;">
                                    <input id="tsLagerCPUUseRate" class="easyui-textbox" data-options="prompt:'>=CPU使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>
                                <td style="padding-left: 50px;padding-top: 10px;">
                                    <input id="tsSmallerCPUUseRate" class="easyui-textbox" data-options="prompt:'<=CPU使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>
                                <td style="padding-left: 50px;padding-top: 10px;">
                                    <input id="tsLagerDiskUseRate" class="easyui-textbox" data-options="prompt:'>=硬盘使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>
                                <td style="padding-left: 50px;padding-top: 10px;">
                                    <input id="tsSmallerDiskUseRate" class="easyui-textbox" data-options="prompt:'<=硬盘使用率(%)'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                                </td>
                            </tr>
                        </table>

                    </div>

                    <div style="padding-top: 40px;padding-left: 10px;">
                        <span style="width: 20%;">
                            <a style="background: #99BBE8;height: 30px;;width: 70%;color: black;" class="easyui-linkbutton" plain="true" onclick="ts_searchTerminal()">搜索</a>
                        </span>
                        <span style="padding-left: 10px;width: 20%;">
                           <a style="background: #99BBE8;height: 30px;width: 72%;color: black;" class="easyui-linkbutton" plain="true" onclick="ts_reset()">重置</a>
                        </span>

                    </div>
                </div>
            </div>

        </div>

        <div align="center" style="padding-top: 20px;height: 50px;">
            <input type="button" id="ts_sure" value="确定" style="border:none;font-size: 20px;background: #99BBE8;width: 150px;" onclick="ts_searchTerminal_sure()"/>
            <input type="button" id="ts_back" value="返回" style="border:none;font-size: 20px;background: #99BBE8;width: 150px;" onclick="$('#selectTerminalDialog').window('close');"/>

        </div>
    </div>

<script>
//    $('#tsTerminalType_select').combobox({
//        valueField:'text',
//        textField:'text',
//        url:'../json/terminal/terminalType.json',
//        editable:false
//    });

    $('#tsType_select').combobox({
        valueField:'id',
        textField:'text',
        url:'../json/terminal/terminalState.json',
        editable:false
    });


    $('#selectTerminalTable').datagrid({
        height:"90%",
        closable:true,
        fitColumns:true,
        nowrap: false,
        striped: true,
        border: true,
        collapsible:false,//是否可折叠的
        fit: true,//自动大小
        remoteSort:false,
        idField:'num',
        singleSelect:false,//是否单选
        pagination:true,//分页控件
        rownumbers:false,//行号,
        selectOnCheck: true,
        checkOnSelect: true,
        onClickRow:function(rowIndex, rowData){
            //取消选择某行后高亮
            $('#selectTerminalTable').datagrid('unselectRow', rowIndex);
        }
    });

    var p = $('#selectTerminalTable').datagrid('getPager');
    $(p).pagination({
        pageSize: 10,
        pageList: [5,10,15],
        beforePageText: '',
        afterPageText: ''
    });

    $("#tsPartionCompany_select").combobox({
        onChange: function (n,o) {
            getStores();
        }
    });

    $(function () {
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/company",
            type: 'GET',
            contentType:"application/json",
            data: {
                partnerId:0
            },
            success: function (res) {
                if(res.status_code === 100) {
                    //res = JSON.stringify(res);

                    let data = res.company;
                    console.log(data);
                    let companies = [];
                    for (let i in data) {
                        companies.push({"text": data[i].CompanyName, "value": data[i].CompanyCode});
                    }
                    console.log(JSON.stringify(companies));
                    $("#tsPartionCompany_select").combobox('loadData', companies);
                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });

        jQuery.support.cors = true;
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/posattr",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "attrs":["Type"]
            }),
            success: function (res) {

                if(res.status_code === 100){
                    let data = res.dic;
                    let types = [];
                    for(let i in data.Type){
                        types.push({"text":data.Type[i].Attr});
                    }

                    $('#tsTerminalType_select').combobox({
                        valueField:'text',
                        textField:'text'
                    });
                    $('#tsTerminalType_select').combobox('loadData', types);


                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });

    });

    function getStores(){
        let companyId = $('#tsPartionCompany_select').combobox('getValue');
        console.log(companyId);
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/store",
            type: 'GET',
            contentType:"application/json",
            data: {
                companyCode:companyId
            },
            success: function (res) {
                console.log(res);
                if(res.status_code === 100){
                   // res = JSON.stringify(res);
                    let data = res.stores;
                    let stores = [];
                    for(let i in data){
                        if(data[i].CompanyCode === companyId){
                            stores.push({ "text": data[i].StoreName, "value": data[i].StoreID });
                        }
                    }
                    $("#tsStore_select").combobox('loadData', stores);
                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }

    function ts_reset(){
        $('#tsPartionCompany_select').combobox('setValue',"");
        $('#tsStore_select').combobox('setValue',"");
        $('#tsTerminalType_select').combobox('setValue',"");
        $('#tsType_select').combobox('setValue',"");
        $('#tsTerminalName_input').textbox('setValue',"");
        $('#tsTerminalNo_input').textbox('setValue',"");
        $('#tsLagerMemoryUseRate').textbox('setValue',"");
        $('#tsSmallerMemoryUseRate').textbox('setValue',"");
        $('#tsLagerCPUUseRate').textbox('setValue',"");
        $('#tsSmallerCPUUseRate').textbox('setValue',"");
        $('#tsLagerDiskUseRate').textbox('setValue',"");
        $('#tsSmallerDiskUseRate').textbox('setValue',"");
    }

    function ts_searchTerminal(){

        let grid = $('#selectTerminalTable');
        let options = grid.datagrid('getPager').data("pagination").options;

        let pageIndex = parseInt(options.pageNumber)-1;
        if(pageIndex === -1){
            pageIndex++;
        }
        let pageSize = parseInt(options.pageSize);

        let componayCode = handleNullNum($('#tsPartionCompany_select').combobox('getValue'));
        let storeId = handleNullNum($('#tsStore_select').combobox('getValue'));
        let posType = handleNullInfo($('#tsTerminalType_select').combobox('getValue'));

        let state = "";
        if(handleNullInfo($('#tsType_select').combobox('getValue'))){
            state = handleNullInfo($('#tsType_select').combobox('getValue')) == "在线"?1:0;
        }
        else{
            state = null;
        }

        let posId = handleNullNum($('#tsTerminalNo_input').textbox('getValue'));
        let memoryUsedBegin = handleNullFloat($('#tsLagerMemoryUseRate').textbox('getValue'));
        let memoryUsedEnd = handleNullFloat($('#tsSmallerMemoryUseRate').textbox('getValue'));
        let cpuUsedBegin = handleNullFloat($('#tsLagerCPUUseRate').textbox('getValue'));
        let cpuUsedEnd = handleNullFloat($('#tsSmallerCPUUseRate').textbox('getValue'));
        let diskUsedBegin = handleNullFloat($('#tsLagerDiskUseRate').textbox('getValue'));
        let diskUsedEnd = handleNullFloat($('#tsSmallerDiskUseRate').textbox('getValue'));

        let reqDate = {
            pageIndex:pageIndex,
            pageSize:pageSize,
            companyCode:componayCode,
            storeId:storeId,
            posType:posType,
            state:state,
            posId:posId,
            memoryUsedBegin:memoryUsedBegin,
            memoryUsedEnd:memoryUsedEnd,
            cpuUsedBegin:cpuUsedBegin,
            cpuUsedEnd:cpuUsedEnd,
            diskUsedBegin:diskUsedBegin,
            diskUsedEnd:diskUsedEnd
        };

        console.log($('#tsStore_select').combobox('getValue'));
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/pos",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify(reqDate),
            success: function (res) {
                console.log(res);
                if(res.status_code === 100){
                    let listData = res.data.rows;
                    console.log(listData);
                    let listDatas = new Array();
                    for (let i=0;i<listData.length;i++) {
                        selectTerminals[listData[i].ID] = listData[i];
                        let rowData =  {
                            'num':listData[i].ID,
                            'tmsNo' : listData[i].PosID,
                            'tmsCompany' : listData[i].CompanyName,
                            'tmsStore' : listData[i].StoreName,
                            'tmsState':listData[i].Status,
                            'tmsMemUsed' : listData[i].MemoryUsed,
                            'tmsCPNUsed' : listData[i].CPULoad,
                            'tmsDiskUsed' : listData[i].Disk1Used//??
                            //'tmDiskNum' : listData[i].Status
                        };
                        listDatas.push(rowData);
                    }
                    let p = $('#selectTerminalTable').datagrid('getPager');
                    $(p).pagination({
                        displayMsg: '共 '+res.data.total+' 条记录'
                    });
                    $('#selectTerminalTable').datagrid('loadData',listDatas);

                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }

    function  ts_searchTerminal_sure(){
        var teRows = $('#selectTerminalTable').datagrid('getSelections');
        let data = [];
        let names = "";
        //console.log(teRows);
        for(let i =0;i<teRows.length;i++){
            //console.log(i);
            data.push({"StoreID":selectTerminals[teRows[i].num].StoreID,"PosID":teRows[i].tmsNo});
            names+=teRows[i].tmsNo;
            names+=",";
        }
        names = names.substr(0,names.length-1);

        $('#terminalupdate_select').searchbox('setValue',names);

        console.log(data);
        selectTerminals = data;
        $('#selectTerminalDialog').window('close');
    }

    $.parser.onComplete = function(){
        ts_searchTerminal();
    };

</script>