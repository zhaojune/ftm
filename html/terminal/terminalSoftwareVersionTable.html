<table id="sv_selectTerminalTable"  cellspacing="0" toolbar="#sv_selectTerminal_tab" cellpadding="0" border="false" style="height:100%;width: 100%;">
                <thead>
                <tr style="font-size: 15px;">
                    <th field="tmNum" width="11%" align="center">终端编号</th>
                    <th field="tmStore" width="13%" align="center">所属门店</th>
                    <th field="tmCompany" width="13%" align="center">所属分公司</th>
                    <th field="tmNP6" width="13%" align="center">NP6</th>
                    <th field="tmNP6APP" width="14%" align="center">NP6 APP</th>
                    <th field="tmSOKPic" width="13%" align="center">SOK图片</th>
                    <th field="tmOwn" width="13%" align="center">自有软件</th>
                    <th field="tmKeyPos" width="13%" align="center">键位</th>

                </tr>
                </thead>

</table>


<div id="sv_selectTerminal_tab" style="padding-left:10px;padding-top:10px;height: 40%;font-size: 15px;">
                <div style="height: 50%;">
                    <table style="padding-left: 10px;height: 10%;width: 95%">
                        <tr>
                            <td>
                                <input id="partionCompany_select" class="easyui-combobox" editable="false" data-options="prompt:'选择分公司'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;">
                                <input id="store_select" class="easyui-combobox" editable="false" data-options="prompt:'选择门店'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;">
                                <input id="terminalType_select" class="easyui-combobox" editable="false" data-options="prompt:'选择终端类型'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>

                            <td style="padding-left: 50px;">
                                <input id="type_select" class="easyui-combobox" editable="false" data-options="prompt:'选择状态'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                        </tr>
                        <tr >
                            <td style="padding-top: 10px;">
                                <input id="terminalName_input" class="easyui-textbox" data-options="prompt:'输入终端名称'" editable="false" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>

                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="terminalNo_input" class="easyui-numberbox" data-options="prompt:'输入终端编号'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="NP6Version" class="easyui-combobox" editable="false" data-options="prompt:'选择NP6版本'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="NP6APPVersion" class="easyui-combobox" editable="false" data-options="prompt:'选择NP6 APP版本'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding-top: 10px;">
                                <input id="SOKPic" class="easyui-combobox" editable="false" data-options="prompt:'选择SOK图片版本'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="Own" class="easyui-combobox" editable="false" data-options="prompt:'自有软件版本'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                            <td style="padding-left: 50px;padding-top: 10px;">
                                <input id="KeyPos" class="easyui-combobox" editable="false" data-options="prompt:'键位版本'" style="font-size: 15px;color:gainsboro;width:100%;height: 30px;"/>
                            </td>
                        </tr>
                    </table>

                </div>

                <div style="padding-top: 40px;padding-left: 10px;">
                        <span style="width: 20%;">
                            <a style="background: #99BBE8;height: 30px;;width: 80px;color: black;"  class="easyui-linkbutton"  onclick="sv_searchTerminal()">搜索</a>
                        </span>
                        <span style="padding-left: 10px;width: 20%;">
                           <a style="background: #99BBE8;height: 30px;width: 80px;color: black;" class="easyui-linkbutton"  onclick="sv_reset()">重置</a>
                        </span>

                    <span style="padding-left: 10px;width: 20%;">
                           <a style="background: #99BBE8;height: 30px;width: 80px;color: black;" href="#" class="easyui-linkbutton"  onclick="exportSVExcel()">导出excel</a>
                        </span>

                </div>
            </div>


<script>


    $('#type_select').combobox({
        valueField:'id',
        textField:'text',
        url:'../json/terminal/terminalState.json',
        editable:false
    });


    $('#sv_selectTerminalTable').datagrid({
        height:"90%",
        closable:true,
        fitColumns:true,
        nowrap: false,
        striped: true,
        border: true,
        collapsible:false,//是否可折叠的
        fit: true,//自动大小
        remoteSort:false,
        idField:'fldId',
        singleSelect:false,//是否单选
        pagination:true,//分页控件
        rownumbers:false,//行号,
        selectOnCheck: true,
        checkOnSelect: true,
        onClickRow:function(rowIndex, rowData){
            //取消选择某行后高亮
            $('#sv_selectTerminalTable').datagrid('unselectRow', rowIndex);
        }
    });

    let p = $('#sv_selectTerminalTable').datagrid('getPager');
    $(p).pagination({
        pageSize: 10,
        pageList: [5,10,15],
        beforePageText: '',
        afterPageText: '',
        displayMsg: '共 {total} 条记录'
    });

    $("#partionCompany_select").combobox({
        onChange: function (n,o) {
            getsv_Stores()
        }
    });

    $(function () {
        jQuery.support.cors = true;
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/company",
            type: 'GET',
            contentType:"application/json",
            data: {
                partnerId:0
            },
            success: function (res) {
                if(res.status_code === 100) {

                    let data = res.company;
                    console.log(data);
                    let companies = [{"text":"全选"}];
                    for (let i in data) {
                        companies.push({"text": data[i].CompanyName, "value": data[i].CompanyCode});
                    }
                    console.log(JSON.stringify(companies));
                    $("#partionCompany_select").combobox('loadData', companies);
                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });

        jQuery.support.cors = true;
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/posattr",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "attrs":["Np6Version","Np6ExeVersion","SOKPicVer","SelfSoft","ForkVersion","Type"]
            }),
            success: function (res) {

                if(res.status_code === 100){
                    let data = res.dic
                    let np6s = [{"text":"全选"}];
                    for(let i in data.Np6Version){
                        console.log(data.Np6Version[i]);
                        np6s.push({"text":(data.Np6Version[i]).Attr});
                    }
                    let np6Apps = [{"text":"全选"}];
                    for(let i in data.Np6ExeVersion){
                        np6Apps.push({"text":data.Np6ExeVersion[i].Attr});
                    }
                    let sokPics = [{"text":"全选"}];
                    for(let i in data.SOKPicVer){
                        sokPics.push({"text":data.SOKPicVer[i].Attr});
                    }
                    let owns = [{"text":"全选"}];
                    for(let i in data.SelfSoft){
                        owns.push({"text":data.SelfSoft[i].Attr});
                    }
                    let keyPoss = [{"text":"全选"}];
                    for(let i in data.ForkVersion){
                        keyPoss.push({"text":data.ForkVersion[i].Attr});
                    }
                    let types = [{"text":"全选"}];
                    for(let i in data.Type){
                        types.push({"text":data.Type[i].Attr});
                    }

                    console.log(np6Apps);

                    $('#terminalType_select').combobox({
                        valueField:'text',
                        textField:'text'
                    });
                    $('#terminalType_select').combobox('loadData', types);
                    $('#NP6Version').combobox({
                        valueField:'text',
                        textField:'text'
                    });
                    $('#NP6Version').combobox('loadData', np6s);
                    $('#NP6APPVersion').combobox({
                        valueField:'text',
                        textField:'text'
                    });
                    $('#NP6APPVersion').combobox('loadData', np6Apps);
                    $('#SOKPic').combobox({
                        valueField:'text',
                        textField:'text'
                    });
                    $('#SOKPic').combobox('loadData', sokPics);
                    $('#Own').combobox({
                        valueField:'text',
                        textField:'text'
                    });
                    $('#Own').combobox("loadData", owns);
                    $('#KeyPos').combobox({
                        valueField:'text',
                        textField:'text'
                    });
                    $('#KeyPos').combobox("loadData", keyPoss);

                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    });

    function getsv_Stores(){
        let companyId = $('#partionCompany_select').combobox('getValue');
        console.log(companyId);
        jQuery.support.cors = true;
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/store",
            type: 'GET',
            contentType:"application/json",
            data: {
                companyCode:companyId
            },
            success: function (res) {
                console.log(res);
                if(res.status_code === 100){
                    // res = JSON.stringify(res);
                    let data = res.stores;
                    let stores = [{"text":"全选"}];
                    for(let i in data){
                        if(data[i].CompanyCode === companyId){
                            stores.push({ "text": data[i].StoreName, "value": data[i].StoreID });
                        }
                    }
                    $("#store_select").combobox('loadData', stores);
                    $('#store_select').combobox('setValue',"全选");
                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }

    function sv_reset(){
        $('#partionCompany_select').combobox('setValue',"");
        $('#store_select').combobox('setValue',"");
        $('#terminalType_select').combobox('setValue',"");
        $('#type_select').combobox('setValue',"");
        $('#terminalName_input').textbox('setValue',"");
        $('#terminalNo_input').textbox('setValue',"");
        $('#NP6Version').combobox('setValue',"");
        $('#NP6APPVersion').combobox('setValue',"");
        $('#SOKPic').combobox('setValue',"");
        $('#Own').combobox('setValue',"");
        $('#KeyPos').combobox('setValue',"");
    }

    function getSVData(){
        let grid = $('#sv_selectTerminalTable');
        let options = grid.datagrid('getPager').data("pagination").options;

        let pageIndex = parseInt(options.pageNumber)-1;
        if(pageIndex === -1){
            pageIndex++;
        }
        let pageSize = parseInt(options.pageSize);

        let componayCode = handleNullInfo($('#partionCompany_select').combobox('getValue'));
        let storeId = handleNullNum($('#store_select').combobox('getValue'));
        let posType = handleNullInfo($('#terminalType_select').combobox('getValue'));
        let state = handleNullInfo($('#type_select').combobox('getValue'));

        let posId = handleNullNum($('#terminalNo_input').textbox('getValue'));
        let Np6Version = handleNullInfo($('#NP6Version').textbox('getValue'));
        let Np6ExeVersion = handleNullInfo($('#NP6APPVersion').textbox('getValue'));
        let SOKPicVer = handleNullInfo($('#SOKPic').textbox('getValue'));
        let SelfSoft = handleNullInfo($('#Own').textbox('getValue'));
        let ForkVersion = handleNullInfo($('#KeyPos').textbox('getValue'));


        let reqDate = {
            pageIndex:pageIndex,
            pageSize:pageSize,
            companyCode:componayCode,
            storeId:storeId,
            posType:posType,
            state:state,
            posId:posId,
            Np6Version:Np6Version,
            Np6ExeVersion:Np6ExeVersion,
            SOKPicVer:SOKPicVer,
            SelfSoft:SelfSoft,
            ForkVersion:ForkVersion
        };

        return reqDate;
    }

    function sv_searchTerminal(){

        let reqDate = getSVData();

        console.log(reqDate);

        jQuery.support.cors = true;
        $.ajax({
            crossDomain: true,
            url: "http://115.159.142.32:20002/pos",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify(reqDate),
            success: function (res) {
                console.log(res);

                if(res.status_code === 100){
                    let listData = res.data.rows;
                    let listDatas = new Array();
                    for ( let i=0;i<listData.length;i++) {
                        let rowData =  {
                            //'tmName' : listData[i].ID,
                            'tmNum' : listData[i].PosID,
                            'tmCompany' : listData[i].CompanyName,
                            'tmStore' : listData[i].StoreName,
                            'tmState':listData[i].Status,
                            'tmNP6' : listData[i].Np6Version,
                            'tmNP6APP' : listData[i].Np6ExeVersion,
                            'tmSOKPic' : listData[i].SOKPicVer,
                            'tmOwn' : listData[i].SelfSoft,
                            'tmKeyPos' : listData[i].ForkVersion
                        };
                        listDatas.push(rowData);
                    }

                    listDatas.sort(function(a,b) {
                        if(a.tmNum< b.tmNum)
                            return -1;
                        else if(a.tmNum> b.tmNum){
                            return 1;
                        }
                        else{
                            return 0;
                        }
                    });

                    $('#sv_selectTerminalTable').datagrid('loadData',listDatas);
                    let p = $('#sv_selectTerminalTable').datagrid('getPager');
                    $(p).pagination({
                        displayMsg: '共 '+res.data.total+' 条记录'
                    });

                }
                else{
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }

    function exportSVExcel(){

    let reqDate = getSVData();


    jQuery.support.cors = true;
    $.ajax({
        crossDomain: true,
        url: "http://115.159.142.32:20002/posexcel",
        type: 'POST',
        contentType:"application/json",
        data: JSON.stringify(reqDate),
        success: function (res) {
            console.log(res);
            if(res.status_code === 100){
                console.log(res.File);
                let path = "http://115.159.142.32:20002"+res.File;
                window.open(path,'','height=500,width=611,scrollbars=yes,status=yes');
            }
            else{
                alert(res.msg);
            }
        },
        error: function (res) {
            console.log(res);
        }
    });
}

$.parser.onComplete = function(){
    sv_searchTerminal();
}


</script>