
<div>
    <table style="width: 100%;padding-top: 10px;">
        <tr>
            <td style="padding-left: 20px;">
                <input id="infoPartionCompany_select" class="easyui-combobox"
                       data-options="prompt:'选择分公司'" style="font-size: 15px;color:gainsboro;width:200px;height: 30px;"/>
            </td>
            <td >
                <input id="infoStore_select" class="easyui-combobox" data-options="prompt:'选择门店'" style="font-size: 15px;color:gainsboro;width:200px;height: 30px;"/>
            </td>
            <td>
                <input id="infoTerminalType_select" class="easyui-combobox" data-options="prompt:'选择终端类型'" style="font-size: 15px;color:gainsboro;width:200px;height: 30px;"/>
            </td>
            <td>
                <a style="background: #99BBE8;height: 30px;;width: 80px;color: black;" href="#" class="easyui-linkbutton" plain="true" onclick="doSearch()">搜索</a>
            </td>
        </tr>
    </table>
</div>


<div style="width: 100%">
    <div style="border-bottom: 1px solid #99BBE8;width:45%;height: 2%;padding: 20px;float:left;">
        <span style="font-size: 15px;">状态统计</span>
        <div id="chart_state" style="width: 300px;height:200px;"></div>
    </div>
    <div style="border-bottom: 1px solid #99BBE8;width:45%;height: 2%;padding: 20px;float:right;">
        <span style="font-size: 15px;">内存使用率统计</span>
        <div id="chart_memory" style="width: 300px;height:200px;"></div>
    </div>
</div>
<div style="width: 100%">
    <div style="border-bottom: 1px solid #99BBE8;width:45%; height: 2%;padding: 20px;float:left;">
        <span style="font-size: 15px;">CPU使用率统计</span>
        <div id="chart_cpu" style="width: 300px;height:200px;"></div>
    </div>
    <div style="border-bottom: 1px solid #99BBE8;width:45%;height: 2%;padding: 20px;float:right;">
        <span style="font-size: 15px;">磁盘使用率统计</span>
        <div id="chart_disk" style="width: 300px;height:200px;"></div>
    </div>
</div>

<script type="text/javascript">
    jQuery.support.cors = true;
    var chart_state = echarts.init(document.getElementById('chart_state'));
    var chart_memory = echarts.init(document.getElementById('chart_memory'));
    var chart_cpu = echarts.init(document.getElementById('chart_cpu'));
    var chart_disk = echarts.init(document.getElementById('chart_disk'));

    var companyCode = '100', storeId = '1', type = 'sc';
    $(function () {
        getCompany();
        getPosType();
        getData();
    })

    function doSearch(){
        companyCode = $("#infoPartionCompany_select").combobox("getValue");
        storeId = $("#infoStore_select").combobox("getValue");
        type = $("#infoTerminalType_select").combobox("getValue");
        getData();
    }
    
    function getData() {
        getStateData();
        getMemoryData();
        getCpuUsedData();
        getDiskUsedData();
    }
    
    function getStateData() {
        $.ajax({
            crossDomain: true,
            url: host+"/posbassis",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "storeId":storeId,
                "companyCode":companyCode,
                "type":type,
                "bassis":"State"}),
            success: function (data) {
                console.log(data)
                if(data.status_code == 100){
                    stateChart(data.data)
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        })
    }

    function getMemoryData() {
        $.ajax({
            crossDomain: true,
            url: host+"/posbassis",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "storeId":storeId,
                "companyCode":companyCode,
                "type":type,
                "bassis":"MemoryUsed"}),
            success: function (data) {
                console.log(data)
                if(data.status_code == 100){
                    memoryChart(data.data)
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        })
    }

    function getCpuUsedData() {
        $.ajax({
            crossDomain: true,
            url: host+"/posbassis",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "storeId":storeId,
                "companyCode":companyCode,
                "type":type,
                "bassis":"CPULoad"}),
            success: function (data) {
                console.log(data)
                if(data.status_code == 100){
                    cpuChart(data.data)
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        })
    }

    function getDiskUsedData() {
        $.ajax({
            crossDomain: true,
            url: host+"/posbassis",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({
                "storeId":storeId,
                "companyCode":companyCode,
                "type":type,
                "bassis":"CPULoad"}),
            success: function (data) {
                console.log(data)
                if(data.status_code == 100){
                    diskChart(data.data)
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        })
    }
    
    function stateChart(data) {
        var option = {
            title : {
                text: 'POS终端在线状态统计',
                subtext: '非码科技',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series : [
                {
                    name: '',
                    type: 'pie',
                    radius : '55%',
                    center: ['50%', '60%'],
                    data:data,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        chart_state.setOption(option);
    }

    function memoryChart(data) {
        var option = {
            title : {
                text: 'POS终端内存使用统计',
                subtext: '非码科技',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series : [
                {
                    name: '',
                    type: 'pie',
                    radius : '55%',
                    center: ['50%', '60%'],
                    data:data,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        chart_memory.setOption(option);
    }

    function cpuChart(data) {
        var option = {
            title : {
                text: 'POS CPU使用率统计',
                subtext: '非码科技',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series : [
                {
                    name: '',
                    type: 'pie',
                    radius : '55%',
                    center: ['50%', '60%'],
                    data:data,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        chart_cpu.setOption(option);
    }

    function diskChart(data) {
        var option = {
            title : {
                text: 'POS 硬盘使用率统计',
                subtext: '非码科技',
                x:'center'
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            series : [
                {
                    name: '',
                    type: 'pie',
                    radius : '55%',
                    center: ['50%', '60%'],
                    data:data,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };
        chart_disk.setOption(option);
    }

    function getCompany() {
        $.ajax({
            crossDomain: true,
            url: host+"/company",
            type: 'GET',
            contentType:"application/json",
            data: {
                partnerId:1205
            },
            success: function (data) {
                if(data.status_code == 100){
                    $("#infoPartionCompany_select").combobox({
                        data: data.company,
                        valueField: 'CompanyCode',
                        textField: 'CompanyName',
                        onLoadSuccess: function () {
//                            var val = $(this).combobox("getData");
//                            for (var item in val[0]) {
//                                if (item == "CompanyCode") {
//                                    $(this).combobox("select", val[0][item]);
//                                }
//                            }
                        },
                        onSelect:function(record){
                            //$.messager.alert('提示', $('#infoPartionCompany_select').combobox('getValue'));
                            getStore($('#infoPartionCompany_select').combobox('getValue'))
                        }
                    });
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }

    function getStore(companyCode) {
        $.ajax({
            crossDomain: true,
            url: host+"/store",
            type: 'GET',
            contentType:"application/json",
            data: {
                companyCode:companyCode
            },
            success: function (data) {
                if(data.status_code == 100){
                    $("#infoStore_select").combobox({
                        data: data.stores,
                        valueField: 'StoreID',
                        textField: 'StoreName',
                        onLoadSuccess: function () {
//                            var val = $(this).combobox("getData");
//                            for (var item in val[0]) {
//                                if (item == "StoreID") {
//                                    $(this).combobox("select", val[0][item]);
//                                }
//                            }
                        },
                        onSelect:function(record){
                            //$.messager.alert('提示', $('#infoStore_select').combobox('getValue'));
                        }
                    });
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }

    function getPosType() {
        $.ajax({
            crossDomain: true,
            url: host+"/posattr",
            type: 'POST',
            contentType:"application/json",
            data: JSON.stringify({"attrs":["Type"]}),
            success: function (data) {
                if(data.status_code == 100){
                    $("#infoTerminalType_select").combobox({
                        data: data.dic.Type,
                        valueField: 'Attr',
                        textField: 'Attr',
                        onLoadSuccess: function () {
//                            var val = $(this).combobox("getData");
//                            for (var item in val[0]) {
//                                if (item == "Attr") {
//                                    $(this).combobox("select", val[0][item]);
//                                }
//                            }
                        },
                        onSelect:function(record){
                            //$.messager.alert('提示', $('#infoTerminalType_select').combobox('getValue'));
                        }
                    });
                }
                else{
                    $.messager.alert('提示', "系统异常");
                }
            },
            error: function (res) {
                console.log(res);
            }
        });
    }

</script>
