
<div style="border-bottom: 1px solid #99BBE8;height: 2%;padding: 20px;">
    <span style="font-size: 20px;">任务详情</span>
</div>

<div>
    <table style="padding-top: 20px;padding-left:40px;font-size: 18px;height: 80%" cellspacing="0">
        <tr style="height: 50px;">
            <td style="width: 100px;">
                <span>任务类型:</span>
            </td>
            <td style="padding-left: 50px;">
                <span id="detailTaskType"></span>
            </td>
            <td id="irs_title" style="padding-left: 20px;">
                <span>更新后是否重启终端:</span>
            </td>
            <td id="de_irs_content" style="padding-left: 50px;">
                <span id="detailIfRestart"></span>
            </td>
        </tr>
        <tr style="height: 50px;">
            <td>
                <span>任务名称:</span>
            </td>
            <td style="padding-left: 50px;">
                <span id="detailTaskName"></span>
            </td>
        </tr>
        <tr style="height: 50px;">
            <td>
                <span>开始时间:</span>
            </td>
            <td style="padding-left: 50px;">
                <span id="detailStartName"></span>
            </td>
            <td style="padding-left: 20px;">
                <span>结束时间:</span>
            </td>
            <td style="padding-left: 0px;">
                <span id="detailEndTime"></span>
            </td>
        </tr>
        <tr style="height: 50px;">
            <td>
                <span>执行策略:</span>
            </td>
            <td style="padding-left: 50px;">
                <span id="detailStrategy"></span>
            </td>
        </tr>
        <tr style="height: 50px;">
            <td>
                <span>更新文件:</span>
            </td>
            <td style="padding-left: 50px;">
                <span id="detailUpdateFile"></span>
            </td>
        </tr>
        <tr style="height: 50px;">
            <td>
                <span>更新终端:</span>
            </td>
            <td style="padding-left: 50px;">
                <span id="detailUpdateTerminal"></span>
            </td>
        </tr>
    </table>

    <div align="center" style="padding-top: 20px;">
        <input type="button" id="detail_back" value="返回" style="border:none;font-size: 20px;background: #99BBE8;width: 150px;" onclick="Back('任务详情')"/>
    </div>

</div>

<script>
    $(function(){
        getDetails();
    });

    function getDetails() {
        jQuery.support.cors = true;
        $.ajax({
            crossDomain: true,
            url: host+"/taskinfo",
            type: 'GET',
            contentType: "application/json",
            data: {
                id: parseInt(currTaskID)
            },
            success: function (res) {
                console.log(res);
                if (res.status_code === 100) {
                    let currTask = res.task;
                    $('#detailTaskType').html(currTask.type);
                    $('#detailTaskName').html(currTask.name);
                    $('#detailStartName').html(dateFormat(currTask.startTime));
                    $('#detailEndTime').html(dateFormat(currTask.endTime));
                    $('#detailIfRestart').html(currTask.needRestart==0?"否":"是");

                    let sty = "";
                    switch (currTask.strategy){
                        case "O":
                            sty="只执行一次";
                            break;
                        case "D":
                            sty="每天执行一次";
                            break;
                        case "W":
                            sty="每周执行一次";
                            break;
                        case "M":
                            sty="每月执行一次";
                            break;
                    }
                    $('#detailStrategy').html(sty);

                    let fn = currTask.filePath;
                    if(!fn ||fn === ""){
                        fn = "无";
                    }
                    else{
                        let fileNames = currTask.filePath.split('/');
                        fn = fileNames[fileNames.length-1];
                    }
                    $('#detailUpdateFile').html(fn);

                    let terminals = "";
                    for(let i in currTask.pos){
                        terminals+=currTask.pos[i].posName;
                        terminals+=",";
                    }
                    terminals = terminals.substr(0,terminals.length-1);

                    if(terminals === ""){
                        terminals = "无"
                    }

                    $('#detailUpdateTerminal').html(terminals);

                }
                else {
                    alert(res.msg);
                }
            },
            error: function (res) {
                console.log(res);
            }
        });

    }

</script>